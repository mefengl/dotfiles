# zmodload zsh/zprof
#2 try
alias d='nr dev 2>/dev/null || nr start'
alias update='brew cu -a -y && tldr --update && chezmoi re-add && chezmoi update'

function ni() {
  command ni "$@"
  echo "nun ${@:1}" >> $HISTFILE
  fc -R $HISTFILE
}
function nun() {
  command nun "$@"
  echo "ni ${@:1}" >> $HISTFILE
  fc -R $HISTFILE
}
function brew() {
  if [[ $1 == 'install' ]]; then
    command brew "$@"
    echo "brew uninstall ${@:2}" >> $HISTFILE
    fc -R $HISTFILE
  elif [[ $1 == 'uninstall' ]]; then
    command brew "$@"
    echo "brew install ${@:2}" >> $HISTFILE
    fc -R $HISTFILE
  else
    command brew "$@"
  fi
}

alias gnb='bash ~/config/git-next-branch.sh'
alias gnbo='gfo && gnb'

# zinit
ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"
[ ! -d $ZINIT_HOME ] && mkdir -p "$(dirname $ZINIT_HOME)"
[ ! -d $ZINIT_HOME/.git ] && git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME"
source "${ZINIT_HOME}/zinit.zsh"

zinit ice as"command" from"gh-r" \
          atclone"./starship init zsh > init.zsh; ./starship completions zsh > _starship" \
          atpull"%atclone" src"init.zsh"
zinit light starship/starship

zinit wait lucid atload"_zsh_autosuggest_start" for zsh-users/zsh-autosuggestions
zinit wait lucid for zsh-users/zsh-syntax-highlighting
# zinit wait lucid for zsh-users/zsh-history-substring-search

# scala
# zinit wait lucid for OMZP::sbt
# zinit wait lucid for OMZP::pip
zinit wait lucid for OMZP::git-prompt
# zinit wait lucid for OMZP::gitignore
zinit wait lucid for OMZP::command-not-found
# zinit wait lucid for OMZP::tmux
# zinit wait lucid for OMZP::terraform

# alias & fast operation
# zinit wait lucid for OMZP::aliases
# zi for nocompile svn \
#   multisrc'aliases.plugin.zsh' pick'/dev/null' \
#     OMZP::aliases
# zinit wait lucid for MichaelAquilina/zsh-you-should-use
# zinit wait lucid for OMZP::git
zinit wait lucid for OMZP::git-auto-fetch
# zinit wait lucid for OMZP::brew
# zinit wait lucid for OMZP::docker-compose

# zinit wait lucid for OMZP::vscode
zinit wait lucid for OMZP::autojump

zinit for \
    atload"zicompinit; zicdreplay" \
    blockf \
    lucid \
    wait \
  zsh-users/zsh-completions

#2 try

# pnpm
export PNPM_HOME="$HOME/.pnpm-global/bin"
case ":$PATH:" in
  *":$PNPM_HOME:"*) ;;
  *) export PATH="$PNPM_HOME:$PATH" ;;
esac
# pnpm end

# docker
alias dockerclean='docker stop $(docker ps -aq); docker rm $(docker ps -aq)'
alias awsdocker='aws ecr get-login-password --region $aws_region | docker login --username AWS --password-stdin $aws_prefix'

#1.2 better for daily
alias \$=''
alias rm='trash'
alias typora='open -a typora'
alias cleanapp='nuke 1Password Arc "GitHub Desktop" WeChat iTerm2 企业微信'
# github_clone(){gh repo list mefengl | awk '{print $1}' | xargs -L1 gh repo clone 2>/dev/null}
# github_update(){echo -e "\033[32mgithub_update:\033[0m";cd ~/GitHub;github_clone;for i in *;do cd $i;git pull;cd ~;done}

##1.2 too see
alias dalle2='bash ~/config/dalle2.sh -p "New Yorker style line drawing, " -n 5 -s "1024x1024" -d'
alias fast-dl='aria2c -x 16 -s 16 -j 16 -k 1M -c -d ~/Downloads'
alias fast-yt-dlp='yt-dlp --external-downloader aria2c --external-downloader-args "-x16 -s16 -k2M"'
alias yt-audio-dl='yt-dlp --external-downloader aria2c --external-downloader-args "-x16 -s16 -k2M" -x --no-playlist'
alias gettxt='cat *.txt'
getfile(){pandoc $1 --to plain}
epub2txt() { for file in *.epub; do pandoc "$file" --to plain -o "${file%.epub}.txt"; done; }
geturls() {
    timestamp=$(date +%Y%m%d%H%M%S)
    mkdir -p ~/Downloads/articles/$timestamp
    node ~/projects/get-articles/index.js $1
}
splittxt() {
    mkdir -p ~/Downloads/txts
    cat *.txt | split -b 180k -d -a 2 - ~/Downloads/txts/
}
copynext() {
    for f in *; do 
        [[ $f != *_sent ]] || continue
        cat $f | pbcopy
        echo -e "\033[0;32mCopied $f\033[0m"
        mv $f ${f}_sent
        break
    done
}

alias vimz='nvim ~/.zshrc'

# git
alias gdd='branch_for_delete=$(git rev-parse --abbrev-ref HEAD) && git switch main && git pull && git branch -d $branch_for_delete'

# github
alias ghr='gh repo'
alias ghc='gh repo clone'
alias ghcm='bash ~/config/ghclone.sh'
## repo
alias ghrc='gh repo list -L 300 | fzf --height 20 --layout=reverse --border | awk "{print $1}" | xargs -I {} gh repo clone {}'
alias ghrd='ghpew repos'
alias ghrv='gh repo view --web'

# node
alias npmb='bash ~/.config/ppm.sh'
alias vimn='nvim ~/.config/ppm.sh'

# homebrew
alias brewb='brew bundle --file=~/.config/homebrew/Brewfile'
alias vimb='nvim ~/.config/homebrew/Brewfile'

# nvim
alias vim='nvim'
alias vimt='nvim ~/.tmux.conf'

# chezmoi
export LANG=en_US.UTF-8

# development
touch ~/development.sh
source ~/development.sh

## yabai&skhd
alias vimy='nvim ~/.config/yabai/yabairc'
alias vims='nvim ~/.config/skhd/skhdrc'

## espanso
alias cde='cd ~/Library/Application\ Support/espanso/match'
alias vime='nvim ~/Library/Application\ Support/espanso/match/base.yml'
alias vimeg='nvim ~/Library/Application\ Support/espanso/match/git.yml'
alias vimed='nvim ~/Library/Application\ Support/espanso/match/del.yml'

## atuin
alias vima='nvim ~/.config/atuin/config.toml'

autoload -Uz compinit
zstyle ':completion:*' menu select
fpath+=~/.zfunc
eval "$(atuin init zsh)"
function gi() { curl -sLw "\n" https://www.toptal.com/developers/gitignore/api/$@ ;}

# Created by `pipx`
export PATH="$PATH:~/.local/bin"

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion
